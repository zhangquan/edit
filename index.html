<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>

        <title>zhangquan</title>

        <script type="text/javascript" src="assets/jquery-1.6.2.min.js"></script>
        <script type="text/javascript" src ="assets/json2.js"></script>
        <link rel="stylesheet" href="assets/editor.css" type="text/css" />
        <script type="text/javascript" src ="assets/tokens.js"></script>
        <script type="text/javascript" src ="assets/parse.js"></script>
        <script type="text/javascript" src ="assets/editor.js"></script>
        <script type="text/javascript" src ="assets/lighter.js"></script>
        <script type="text/javascript" src ="assets/jslint.js"></script>




    <body>

        <div class="main">

            <div class="menu">
                <ul>
                    <li class="open">
                        <a href="#">打开</a>
                        <input type="file" class="open-file" name ="name"/>
                    </li>
                    <li class="saveas">
                        <a href="#" target="_blank"  class="save-file">保存为</a>
                    </li>

                    <li class="run">
                        <a href="#"  class="run-file">运行</a>
                    </li>

                </ul>


            </div>


            <div id="editor" class="editor">
                <div class="line-num"></div>
                <div class="source">
                    <div class="selection">
                        <div class="range first"></div>
                        <div class="range center"></div>
                        <div class="range last"></div>
                    </div>
                    <div class="cursor"></div>
                    <textarea class="input"></textarea>
                    <div class="text"></div>
                </div>

            </div>




            <div style="display:none">   <div><a href="#" onclick="showValue()">value</a>  <a href="#" onclick="showParse()">parse</a></div>

                <pre class="log"></pre>
            </div>




        </div>
        <pre style="display:none" id="code">

(function () {
    "use strict";

    var $, editor, tokens, showError;

    function showValue() {
        $(".log").html(editor.doc.getValue());
    }

    showError = function (msg) {
        $(".log").html($(".log").html() + msg + "d");
    };

    function showParse() {
        var t = tokens(editor.doc.getValue());
        $(".log").html(JSON.stringify(t));
    }
    
}());
        </pre>
        <script type="text/javascript">
          
            var fileType ="application/x-javascript";
            

            var editor =  new Editor($("#code").text())
            
            var openfile = $(".open-file");
            openfile.bind("change",function(ev){
                
              
                var files = ev.target.files;
               
                for (var i = 0; i < files.length; i++) {  
                    var file = files[i];  
                    var imageType = /application.*/;  
      
                    /*if (!file.type.match(imageType)) {  
                        continue;  
                    } 
                     */
                    
                    fileType = file.type;
                 
      
                    console.log(file.type)
                    var reader = new FileReader();  
                    reader.onload = function(e) { 
                        
                        editor.doc.setValue(e.target.result);
                    };  
                  
                    reader.readAsText(file);  
                  
                  
                }
            })
            
            $(".save-file").bind("mousedown",function(e){
                var BlobBuilder = window.WebKitBlobBuilder ||window.MozBlobBuilder ;
               
                var bb =new BlobBuilder();
                bb.append(editor.doc.getValue())
                var newReader = new FileReader();
                newReader.onload = function(e){
                    console.log(e.target.result);
                  
                    $(".save-file").attr("href", e.target.result);
                    //window.open (e.target.result, 'newwindow', 'height=100, width=400, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no') 
                }
                newReader.readAsDataURL(bb.getBlob(fileType));
                
            
            })
 
            
            
            
          
            
            $(".run-file").click(function(ev){
               
                ev.stopPropagation();
                var t = editor.doc.getValue();
                eval(t);
            })
            
            // In the DOM or worker context:



        </script>


    </body>
</html>